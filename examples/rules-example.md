# Пример настройки rules для MCP Laravel Debug

Добавьте этот блок в ваш файл правил (например, `.kilocode/rules/Правила.md`):

```markdown
### MCP Laravel Debug (Отладка и Логи)
Прямой доступ к логам Debugbar через `.ladebugermcp/mcp-server.php`.

**Протокол отладки**:
1. **Очистка**: Перед началом теста всегда вызывай `debugbar_clear`
2. **Тест**: Попроси пользователя выполнить конкретное действие в браузере
3. **Анализ**: Используй `debugbar_get_request_tree` для анализа цепочки запросов
4. **Детали**: При обнаружении аномалий используй `debugbar_get_logs`

**Типичные сценарии**:
- **Медленная страница**: `queries`, `models`, `views` — найти медленные SQL и N+1 проблемы
- **Ошибка 500**: `exceptions`, `route` — изучить стек ошибки и контроллер
- **Редиректы**: анализировать `referer` → `location` цепочки в дереве запросов
- **Права доступа**: `gate`, `route` — проверить проверки авторизации

**Советы**:
- Не запрашивай `session` без необходимости — большой объём данных
- Анализируй queries с `duration > 100ms` — потенциальные проблемы
- Проверяй models с `retrieved > 100` — возможные N+1 проблемы
```

---

## Пример использования в скилле

Создайте файл `.agent/skills/skills/debugger/SKILL.md`:

```markdown
---
name: debugger
description: Debugging specialist for errors, test failures, and unexpected behavior.
---

## Протокол браузерного тестирования с MCP Debugbar

### Порядок действий

#### 1. Очистка логов (обязательно перед тестом)

```
Вызов: debugbar_clear
Результат: "Очищено файлов: N"
```

#### 2. Запрос на выполнение действий

Попросите пользователя выполнить конкретное действие в браузере:

**Примеры запросов:**
- "Откройте страницу /crm/orders и нажмите кнопку 'Экспорт'"
- "Перейдите в раздел отчётов и примените фильтр по дате"
- "Создайте новый заказ через форму"

#### 3. Получение дерева запросов

```
Вызов: debugbar_get_request_tree
Параметры: { "limit": 20 }
```

**Анализ дерева:**
- Найдите целевой запрос по URL
- Проверьте HTTP статус (200, 302, 500)
- Изучите parent-child связи (referer → location)

#### 4. Детальный анализ логов

```
Вызов: debugbar_get_logs
Параметры: { "sections": ["queries", "models", "exceptions"] }
```

### Типичные сценарии

| Проблема | Секции для анализа | Что искать |
|----------|-------------------|------------|
| Медленная страница | `queries`, `models`, `views` | SQL с duration > 100ms, N+1 (retrieved > 100) |
| Ошибка 500 | `exceptions`, `route` | message, file, line в exceptions |
| Лишние редиректы | дерево запросов | цепочка referer → location |
| Проблемы прав | `gate`, `route` | проверки gate, контроллер |
```
